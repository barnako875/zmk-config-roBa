#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/pointing.h>

#define ZMK_POINTING_DEFAULT_SCRL_VAL 100

&mt {
    flavor = "balanced";
    quick-tap-ms = <0>;
};

&trackball {
    automouse-layer = <4>;
    scroll-layers = <5>;

    // トラックボール感度調整のための設定
    behavior = <&trackball_sensitivity>;  // トラックボール感度変更のbehaviorを指定
};

// トラックボール感度調整用のbehaviorを定義
&behaviors {
    trackball_sensitivity: behavior_pointer_speed {
        compatible = "zmk,behavior-pointer-speed";
        listener = <&trackball_input_listener>;
        multiplier = <1>;
        divisor = <1>;

        // トラックボールの移動量に基づいて感度調整
        adjustments {
            size_1 {
                min = <0>;
                max = <10>;
                multiplier = <0.5>;  // 最小の動きでは感度を半分に
            };

            size_2 {
                min = <11>;
                max = <25>;
                multiplier = <1.0>;  // 中程度の動きでデフォルト感度
            };

            size_3 {
                min = <26>;
                max = <50>;
                multiplier = <1.5>;  // 大きな動きでは少し速く
            };

            size_4 {
                min = <51>;
                max = <80>;
                multiplier = <2.0>;  // より大きな動きで感度を増加
            };
        };
    };

    scroll_up_down: behavior_sensor_rotate_mouse_wheel_up_down {
        compatible = "zmk,behavior-sensor-rotate";
        #sensor-binding-cells = <0>;
        bindings = <&msc SCRL_DOWN>, <&msc SCRL_UP>;

        tap-ms = <20>;
    };

    lt_to_layer_0: lt_to_layer_0 {
        compatible = "zmk,behavior-hold-tap";
        label = "LAYER_TAP_TO_0";
        bindings = <&mo>, <&to_layer_0>;
        #binding-cells = <2>;
        tapping-term-ms = <200>;
    };
};

&keymap {
    compatible = "zmk,keymap";

    default_layer {
        bindings = <
            &kp Q &kp W &kp E &kp R &kp T &kp Y &kp U &lt 5 I &kp O &kp P
            &kp A &kp S &kp D &kp F &kp G &mkp MB3 &kp MINUS &kp H &kp J &kp K &kp L &kp SQT
            &mt LEFT_SHIFT Z &kp X &kp C &kp V &kp B &kp COLON &kp SEMICOLON &kp N &kp M &kp COMMA &kp DOT &kp SLASH
            &kp LCTRL &kp LEFT_WIN &kp LEFT_ALT &lt_to_layer_0 6 INT_HENKAN &lt 2 SPACE &lt_to_layer_0 3 INT_MUHENKAN &kp BACKSPACE &lt 1 ENTER &kp DEL
        >;

        sensor-bindings = <&scroll_up_down>;
    };

    // その他のレイヤーと設定が続く...
};
